## 对象池

**1、什么是对象池**

对象池，就是一定数量的已经创建好的对象(Object)的集合。当需要创建对象时，先在池中获取，如果池中没有符合条件的对象，再进行创建新对象，同样，当对象需要销毁时，不做真正的销毁，而是将其setActive(false)，并存入池子中。这样就避免了大量对象的创建。

**2、对象池解决什么问题？**
**减少频繁创建和销毁对象带来的成本，实现对象的缓存和复用**，创建对象的成本比较大，并且创建比较频繁。比如线程的创建代价比较大，于是就有了常用的线程池。对象池（模式）是一种创建型设计模式，它持有一个初始化好的对象的集合，将对象提供给调用者。

**3、对象池的优缺点**

**对象池的优点：**

- 提升了获取对象的响应速度，比如单个线程和资源连接的创建成本都比较大。
- 运用对象池化技术可以显著地提升性能，尤其是当对象的初始化过程代价较大或者频率较高时。
- 一定程度上减少了GC的压力。对于实时性要求较高的程序有很大的帮助。比如说http链接的对象池，Redis对象池等等都使用了对象池

**对象池的缺点**

+ 脏对象的问题
  所谓的脏对象就是指的是当对象被放回对象池后，还保留着刚刚被客户端调用时生成的数据。
  脏对象可能带来两个问题：
  1）脏对象持有上次使用的引用，导致内存泄漏等问题。
  2）脏对象如果下一次使用时没有做清理，可能影响程序的处理数据。
+ 生命周期的问题
  处于对象池中的对象生命周期要比普通的对象要长久。维持大量的对象也是比较占用内存空间的。

**4、对象池有什么特征？**
一般来说，对象池有下面几个特征：
（1）对象池中有一定数量已经创建好的对象
（2）对象池向用户提供获取对象的接口，当用户需要新的对象时，便可通过调用此接口获取新的对象。如果对象池中有事先创建好的对象时，就直接返回给用 户；如果没有了，对象池还可以创建新的对象加入其中，然后返回给用户
（3）对象池向用户提供归还对象的接口，当用户不再使用某对象时，便可通过此接口把该对象归还给对象池

**5、池的大小选择**
通常情况下，我们需要控制对象池的大小如果对象池没有限制，可能导致对象池持有过多的闲置对象，增加内存的占用。如果对象池闲置过小，没有可用的对象时，会造成之前对象池无可用的对象时，再次请求出现的问题。

对象池的大小选取应该结合具体的使用场景，结合数据（触发池中无可用对象的频率）分析来确定。现在Java的对象分配操作不比c语言的malloc调用慢, 对于轻中量级的对象, 分配/释放对象的开销可以忽略不计，并发环境中, 多个线程可能(同时)需要获取池中对象, 进而需要在堆数据结构上进行同步或者因为锁竞争而产生阻塞, 这种开销要比创建销毁对象的开销高数百倍;由于池中对象的数量有限, 势必成为一个可伸缩性瓶颈;很难正确的设定对象池的大小, 如果太小则起不到作用, 如果过大, 则占用内存资源高。
 空间换时间的折中,本质上，对象池属于空间换时间的折中。它通过缓存初始化好的对象来提升调用者请求对象的响应速度。除此之外，折中（tradeoff）是软件开发中的一个重要的概念，会贯穿整个软件开发过程中。